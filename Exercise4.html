<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Activity Monitor Pro</title>
    <style>
        :root { --bg: #0d1117; --text: #c9d1d9; --accent: #58a6ff; --warn: #da3633; }
        body { font-family: 'Segoe UI', monospace; background: var(--bg); color: var(--text); padding: 20px; }
        .dashboard { display: grid; grid-template-columns: 1fr 350px; gap: 20px; height: 80vh; }
        
        /* Interaction Area */
        #monitorZone { background: #161b22; border: 2px dashed #30363d; border-radius: 8px; padding: 20px; }
        .test-btn { padding: 15px; background: var(--accent); color: white; border: none; border-radius: 4px; cursor: pointer; }
        input { width: 100%; padding: 10px; margin-top: 10px; background: #0d1117; color: white; border: 1px solid #30363d; }
        
        /* Log Display */
        #logDisplay { background: #010409; border: 1px solid #30363d; border-radius: 8px; overflow-y: auto; padding: 10px; font-size: 13px; }
        .log-entry { margin-bottom: 5px; border-bottom: 1px solid #161b22; padding-bottom: 2px; }
        .type-tag { font-weight: bold; color: var(--accent); margin-right: 5px; }
        
        /* Warning Banner */
        #warningBanner { background: var(--warn); color: white; padding: 10px; border-radius: 4px; margin-bottom: 15px; display: none; text-align: center; font-weight: bold; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        .controls { margin-top: 20px; display: flex; gap: 10px; }
        button.action { padding: 10px 20px; border-radius: 4px; border: none; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <div id="warningBanner">⚠️ SUSPICIOUS ACTIVITY: HIGH CLICK FREQUENCY</div>

    <div class="dashboard">
        <div id="monitorZone">
            <h3>Interaction Sandbox</h3>
            <p>Every click, keypress, or focus change here is logged.</p>
            <button class="test-btn" id="clickMe">Click Me Repeatedly</button>
            <input type="text" id="textInput" placeholder="Type something or focus here...">
        </div>

        <div id="logDisplay">
            <div style="color: #8b949e;">// Waiting for user activity...</div>
        </div>
    </div>

    <div class="controls">
        <button class="action" style="background: #30363d; color: white;" onclick="resetLog()">Reset Monitor</button>
        <button class="action" style="background: #238636; color: white;" onclick="exportLog()">Export Log (.txt)</button>
    </div>

<script>
    // 1 & 2. Requirement: Array of objects for storage
    let logs = [];
    let clickCounter = 0;
    const CLICK_THRESHOLD = 10; // Threshold for "suspicious" clicks within a short window

    const logDisplay = document.getElementById('logDisplay');
    const warningBanner = document.getElementById('warningBanner');
    const monitorZone = document.getElementById('monitorZone');

    // 3. Requirement: Event Bubbling and Capturing
    // Global Capturing Listener (Third param 'true')
    window.addEventListener('click', (e) => {
        logEvent('Global Capture', `Target: ${e.target.tagName}`);
    }, true);

    // Monitor Zone Bubbling Listener
    monitorZone.addEventListener('click', (e) => {
        clickCounter++;
        logEvent('Bubble Click', `Element: ${e.target.id || e.target.className}`);
        checkSuspicious();
    });

    // 1. Requirement: Track Keypresses and Focus
    monitorZone.addEventListener('keydown', (e) => {
        logEvent('Keypress', `Key: "${e.key}"`);
    });

    // Focus events do not bubble, so we use 'focusin' which does bubble
    monitorZone.addEventListener('focusin', (e) => {
        logEvent('Focus', `Entered: ${e.target.tagName}`);
    });

    // 4. Requirement: Dynamically display the log using the DOM
    function logEvent(type, detail) {
        const entry = {
            time: new Date().toLocaleTimeString(),
            type: type,
            detail: detail
        };
        logs.push(entry);

        const row = document.createElement('div');
        row.className = 'log-entry';
        row.innerHTML = `<span class="type-tag">[${entry.time}] ${entry.type}:</span> ${entry.detail}`;
        
        logDisplay.prepend(row); // Most recent at the top
    }

    // 5. Requirement: Suspicious activity thresholds
    function checkSuspicious() {
        if (clickCounter >= CLICK_THRESHOLD) {
            warningBanner.style.display = 'block';
            // Auto-reset warning after 3 seconds
            setTimeout(() => {
                warningBanner.style.display = 'none';
                clickCounter = 0;
            }, 3000);
        }
    }

    // 6. Requirement: Reset and Export as formatted text
    function resetLog() {
        logs = [];
        clickCounter = 0;
        logDisplay.innerHTML = '<div style="color: #8b949e;">// Log cleared.</div>';
        warningBanner.style.display = 'none';
    }

    function exportLog() {
        if (logs.length === 0) return alert("Nothing to export!");

        const content = logs.map(l => `[${l.time}] ${l.type.toUpperCase()} | ${l.detail}`).join('\n');
        const blob = new Blob([content], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `activity_report_${Date.now()}.txt`;
        a.click();
        
        URL.revokeObjectURL(url);
    }
</script>
</body>
</html>